<!doctype html><html lang=en><head><link rel=canonical href=https://oskar-anderson.github.io/InternshipBlog/content/AB-muutmine-ja%20vana%20koodi%20kohandamine/><title>AB muutmine ja vana koodi kohandamine - My Internship Blog</title><link type=text/css href=https://oskar-anderson.github.io/InternshipBlog/css/bootstrap.min.css rel=stylesheet crossorigin=anonymous><link type=text/css href=https://oskar-anderson.github.io/InternshipBlog/css/main-layout.css rel=stylesheet crossorigin=anonymous><link rel=icon type=image/png href=https://oskar-anderson.github.io/InternshipBlog/favicon.png crossorigin=anonymous></head><body><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://oskar-anderson.github.io/InternshipBlog/>Home</a></h1></div></div></header><header class=post-header><h1 class=post-title itemprop="name headline">AB muutmine ja vana koodi kohandamine</h1></header><div class=container><div class=row><div class="col-sm-9 blog-main"><article class=blog-post><header><h2 class=blog-post-title dir=auto><a href=https://oskar-anderson.github.io/InternshipBlog/content/AB-muutmine-ja%20vana%20koodi%20kohandamine/>AB muutmine ja vana koodi kohandamine</a></h2><p class=blog-post-meta><time datetime=2021-04-24>2021-04-24</time>
Karl Oskar Anderson
<span class="fas fa-tag" aria-hidden=true></span>&nbsp;<a href=/InternshipBlog/tags/praktika/ rel=tag>praktika</a> <a href=/InternshipBlog/tags/riina-tallo/ rel=tag>Riina Tallo</a></p></header><h2 id=8-n√§dal>8. n√§dal</h2><h3 id=1904>19.04</h3><p>Programmeerisin&mldr;</p><p>Sensorite m√µ√µtmiste andmeid kujutatakse tabelis, aga sensori erinevaid andmeid on liiga palju, et nad tabelisse ilusti √§ra mahuksid. Algne idee oli panna sensorite peal lingid, mis avavad modal elemendi sensori andmetega. Paraku selgus, et collapsable element oleks parem valik koodi struktuuri ja kasutajaliidese poolest. Collapsable kasutusele v√µtmiseks tuleb tabel element asendada grid elemendiga.</p><h3 id=2004>20.04</h3><p>Uurisin portatiivset sensorit. Sain sensori v√µrgus t√∂√∂le muutes IP-aadressi. Lisaks v√µis probleem seisneda selles, et ethernet √ºhendus vajab seadme √ºhendamist laadjaga. Ethernet √ºhendus j√§√§b arusaamatuks - seadmel on ka USB, mis lisaks andmevahetusele ka laeb seadet. Ethernet √ºhendus lubab seadme veebiliidesest andmeid vaadata ja seadistusi muuta, aga k√µike seda saab ka seadmes endas teha. Seadme t√§isv√µimsuses kasutamiseks l√§heb vaja Comet Vision tarkvara.</p><p>J√§√§b arusaamatuks, kas seade on v√µimeline AB-ga suhtluseks. SOAP protokolli toetus puudub, aga alternatiivina on mingi data link v√µimalus - mina ei ole data linkist midagi kuulnud. Seade v√µib osutuda mulle andmete genereerimise ja AB suhtluse testimise eesm√§rkidel kasulikuks.</p><p>Exportisin AB sql andmed ja struktuuri. Ma ei tea t√§pselt, mis edasi teha - kooliprojektides anti AB server ette ja andmete migratsiooniga kokku ei puudutud.</p><h3 id=2104>21.04</h3><p>Proovin kasutada K√§veri √µpetatud tehnikat - teha andmebaas C# Entity Framework ORM-iga ja kasutada Razor Pages generaatorit CRUD baaslehek√ºlgede loomiseks ja kopeerida genereeritud html p√§ris PHP lahendusele √ºmber.</p><h3 id=2204>22.04</h3><p>Esines probleeme portatiivse sensoriga:</p><ul><li>Kontoriv√µrgus osutus protatiivse sensori IP aadressi probleeme - arvutiga otse √ºhendades seade t√∂√∂tas aga kontoriv√µrgus ei t√∂√∂ta, IP vahetamisel vastupidine probleem.</li><li>Cometi programmis esineb probleeme √ºhendatud seadme tuvastamises, programmi taask√§ivitamine tundub probleemi lahendavat.</li><li>Veebiliideses konfiguratsiooni lehek√ºlje varem olemasolev sisu on osaliselt kadunud. P√µhjus teadmata. IP aadressi probleem???</li></ul><p>Sensori andmete AB j√µudmise protsess t√∂√∂tab ajalise intervalliga - mitte nupule vajutamisega v√µi seadme v√µrku √ºhendamisega. Portatiivsetele sensoritele andmetesse oleks vaja teistsugust l√§henemist. Oleks vaja AB teha manuaalne andete √ºleslaadimise v√µimalus CSV failist.</p><h3 id=2304>23.04</h3><p>Proovisin EF AB √ºlesse seada.</p><p>Enamus andmeid sain k√§sitsi uude AB √ºleviimiseks kirja panna. Vanad m√µ√µtmise andmed salvestasin teksti faili, aga nende AB saamisega tekkis probleeme:</p><ul><li>Probleem relatiivse faili asukohaga</li><li>Regex-iga andmete k√§ttesaamine ja s√µnede manipuleerimine</li><li>Insert p√§ringu 1000 rea korraga sisestamise piirang</li></ul><p>Esines probleeme AB tabelite auto-inkrementeeritud id-dega. Nende v√§√§rtust ei tundu olevat v√µimalik AB andmete sisestus p√§ringuga kaasa anda. V√µimalik, et viin id UUID formaadile √ºle.</p><h2 id=9-n√§dal>9. n√§dal</h2><h3 id=2604>26.04</h3><p>C# ei √µnnestunud MySql serverit luua. Leppisin Sqlite lokaalse andmebaasiga ja genereerisin CRUD lehek√ºljed. Loodetavasti saan genereeritud koodi l√µpliku PHP rakenduse peale √ºmber kopeerida.</p><h3 id=2704>27.04</h3><p>Aivar k√ºsis portatiivset sensorit tagasi tuleseks temperatuurikontrolliks rekkates. Proovisime portatiivset sensorit AB √ºhendada; ei √µnnestunud, aga v√§idetavalt kunagi on see toiminud.</p><p>Programmeerisin&mldr;</p><h3 id=2804>28.04</h3><p>Programmis on andmebaasi p√§ringud igal pool l√§bisegi. Proovisin teha AB p√§ringuteks eraldi abiklassi nagu K√§veriga platvormip√µhised moobilirakendused tunnis. Ideaalis on AB v√§ljade nimed antud muutujatena ja mitte k√§sitsi sissekirjutatult. Tahaksin panna v√§ljade nimed mudelite v√§ljadele annotatsioonina k√ºlge nagu C# EF ORM-iga. Arvan, et see ei ole PHP-s v√µimalik. Pean AB v√§ljade nimed andma GetNameOfFoo() funktsioonidest.</p><p>Kahjuks pean AB mudelit uuesti muutma.</p><h3 id=2904>29.04</h3><p>Programmeerisin alarms skripti √ºmber. Selle funktsioon j√§√§b siiski arusaamatuks. Tundub olevat eraldiseisev k√§surea programm. Programm sisaldab palju segast s√µnede manipuleerimist ja printimist.
Selle programmi olemasolu tekitab segadust:</p><ul><li>Vendor kaustas on 9 teeki + Composer, aga ainult 1 teek on kasutuses ja seda kasutatakse ka ainult eraldiseisvas programmis. L√µppkasutajat see programm ei puuduta. Kelle jaoks k√µik need teegid?</li><li>AB on selle programmi jaoks eraldiseisev tabel.</li></ul><p>V√µimalik, et programm on poolelij√§√§nud idee.</p><h3 id=3004>30.04</h3><p>MyTV NUC&rsquo;il esines taas probleem k√§ivitumisega. Seadme k√µvaketas sai √ºlekontrollitud ja seade hakkas t√∂√∂le. K√ºsisin l√µplikumaks lahenduseks abi MyTV-st. Esmasp√§eval lubasid tehniku saata.</p><p>Kaotasin programmist globaalsed muutujad √§ra. Panin kontrolleri ja vaate pooled √ºhte faili kokku. Andmed pannakse kontrolleri osas &lsquo;associative array&rsquo;-sse ja laetakse lehek√ºlje vaate poolel v√µtme j√§rgi v√§lja.</p><p>Ennem:</p><pre><code>&lt;?php require(&quot;header.php&quot;); ?&gt; &lt;!-- Kontrolleri pool --&gt;
&lt;!DOCTYPE HTML&gt; &lt;!-- Lehek√ºlje vaate pool --&gt;

&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;?php echo $id ?&gt; &lt;!-- PHPStorm hoiatab deklareerimata muutujast (VS Code ei hoiata), aga seni kui header.php omab $id muutujat laeb lehek√ºlg probleemideta --&gt;
&lt;/body&gt;
</code></pre><p>Praegu:</p><pre><code>&lt;?php 
 
$htmlInjects = [];
main($htmlInjects);

function main(&amp; $htmlInjects): void {
    // logic

    $htmlInjects['id'] = $id;
    $htmlInjects['sensors'] = $sensors;
}
?&gt; &lt;!-- Kontrolleri pool --&gt;
&lt;!DOCTYPE HTML&gt; &lt;!-- Lehek√ºlje vaate pool --&gt;

&lt;html&gt;
&lt;head&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;?php echo $htmlInjects['id'] ?&gt;
&lt;/body&gt;
</code></pre><p>Tegu ei pruugi olla parima lahendusega, kui tahta partials vaateid luua peaks hoidma k√µik kontrolleri loogika eraldi failis ja kasutama mingit malli mootori teeki nagu Twig v√µi Latte, et lehek√ºlje sisu √µigesse kohta lisada. Praegune lahendus on siiski endisest parem.</p><p>M√§rt Kalmo PHP tundides me kasutasime mallide t√∂√∂tlemise jaoks mingit tpl.php nimelist teeki. Aga minuarust kirjutas Kalmo selle teegi ise, v√§hemalt mingit infot ega erilist dokumentatsiooni me selle kohta ei saanud - Kalmo n√§itas meile lihtsalt paar teegi kasutamise n√§idet ette. Leidsin teegi √ºles:</p><ul><li><a href=https://github.com/mkalmo/php-ng-template>https://github.com/mkalmo/php-ng-template</a></li><li><a href=https://bitbucket.org/mkalmo/php-template/>https://bitbucket.org/mkalmo/php-template/</a></li></ul><p>Tundub, et see ongi Kalmo enda kirjutatud. Iseenesest peaks see teek minu vajadusi rahuldama, aga ma ei saa aru, miks keegi tahaks vastutada tundmatu teegi kasutuselev√µtmise eest, kui on olemas populaarsemad ja ametlikumad teegid.</p><p>Visual Studio Code (VS Code) ei hoiata deklareerimata muutujatele kasutamise eest - viga tuleb lehek√ºljele sisenemisel. Kasutan edaspidi Jetbrains PHPStormi.</p><h2 id=10-n√§dal>10. n√§dal</h2><h3 id=0305>03.05</h3><p>Tehnikut ei tulnud.</p><p>Lisasin sensorite grid-tabelisse collapseable sektsiooni sensori lisainfo jaoks, aga sisu siin veel ei ole. Selle jaoks peab AB v√§lju lisama ja p√§ringud koostama.</p><h3 id=0405>04.05</h3><p>Algne idee oli arenduse AB loomisel sisestada sinna esialgsed vana AB andmed. Enamus andmeid sai koodi sisse kirjutada, aga sensori m√µ√µtmise tabelis on 160000 rida andmeid. Ekspordidtud insert p√§ringuid PHP reahaaval lugeda ei tahtnud - programm luges paaritutelt ridadelt v√§√§rtuse &lsquo;1&rsquo; ja paaris ridadelt failirea p√§ris v√§√§rtuse. Lahenduseks p√§ritakse andmed vanast AB ja sisestatake uude.</p><p>Vahetasin AB poolt autoinkrementeeritavad id programmi poolt genereeritavate uuid vastu v√§lja. Uuid on tegelt oma omaduste poolest √ºsna kehva. Andmebaasis on uuid v√§√§rtuse lihtasaimaks ja universaalsemaks t√º√ºbiks VARCHAR s√µne. Uuid on 32 karakterit pikk objekt, aga s√µne esituses lisandub veel 4 sidekriipsu. Karakterid ise on 16-baasil, teisis√µnu v√µimalikud karakterite v√§√§tused on &lsquo;0123456789abcdef&rsquo;. Nii veebi urlide, AB mahu kui ka arenduse aspektist oleks lihtsam t√∂√∂tada l√ºhemate s√µnedega.</p><p>Composeriga sain installitud Ramsey Uuid teegi, millega proovisin duplikeerida C# projekti id genereerimise lahendust. Vaja ei ole mitte uuid ise, vaid pigem teegi poolt kasutatavat usaldusv√§√§rset RNG generaatorit. C# on v√µimalik id pikkust v√§hendada 22 karakterini nii:</p><pre><code>Console.WriteLine(ToShortString('00112233-4455-6677-8899-aabbccddeeff);
// output: MyIRAFVEd2aImaq7zN3u_w

public static string ToShortString(Guid guid) {
    string base64Guid = Convert.ToBase64String(Guid guid.ToByteArray());
    base64Guid = base64Guid.Replace('+', '-').Replace('/', '_');
    return base64Guid.Substring(0, base64Guid.Lenght - 2);
}
</code></pre><p>Identset funktsiooni PHPs teha ei √µnnestunud - kuigi sarnane base64_encode funktsioon eksisteerib puudub byteArray t√º√ºp. base64_encode funktsiooni l√§heb sisendiks 256 karakteri kodeeringus s√µne, mitte 16-baasil number - saadud tulemus on veel pikem s√µne.</p><p>Leidsin Stackoverflow erineva kvaliteediga lahendusi:</p><ul><li><a href=https://stackoverflow.com/questions/1846202/how-to-generate-a-random-unique-alphanumeric-string>https://stackoverflow.com/questions/1846202/how-to-generate-a-random-unique-alphanumeric-string</a></li><li><a href=https://stackoverflow.com/questions/4356289/php-random-string-generator>https://stackoverflow.com/questions/4356289/php-random-string-generator</a></li></ul><p>Leppisin Scotti lahendusega:</p><pre><code>public static function GenerateId() {
    $guid = base64_encode(random_bytes(40));
    $guid = str_replace(['+', '/', '='], ['-', '_', ''], $guid);
    return substr($guid, 0, 22)
}
</code></pre><h3 id=0505>05.05</h3><p>Require lausetega mudelite ja funktsioonide kutsumine muudest failidest on k√§est √§ra l√§inud - faile on liiga palju ja nende s√µltuvused j√§√§vad segaseks. V√µtsin Composeriga kasutusele autoloaderi ja panin failidele namespace&rsquo;id.</p><h3 id=0605>06.05</h3><p>Isiklik arenduse andmebaas on duplikeeritud andmetega l√µpuks √ºleval. üî•</p><h3 id=0705>07.05</h3><p>Muutsin failide struktuuri:</p><ul><li>vaated, mudelid ja kontrollerid eraldi kaustades</li><li>CSS ja pildid √ºhtses &lsquo;static&rsquo; kaustas</li><li>kogu AB suhtlus liikus DAL kausta, mitte igalpool segi</li></ul><p>Leidsin, et mingit raamistiku ei ole vaja. Lehek√ºlgi saab kontrollerist lihtsalt require v√µtmes√µnaga v√§lja kutsuda ja kasutades skoobis olevaid muutujaid. Nii on v√µimalus luua ka partial view n√§iteks metaandmete jaoks.</p><pre><code>---------viewController/index.php------------
&lt;?php
main()

function main() {
    $htmlInjects = [];
    $htmlInjects['root'] = '../';
    $htmlInjects['graph'] = $someOtherData;

    render(__DIR__ . '/../view/main/index.php', $htmlInjects);
}

function render($filename, $htmlInjects) {
    require($fileName);
}
</code></pre><pre><code>---------view/main/index.php------------
&lt;html&gt;
&lt;head&gt;
    &lt;?php require ($htmlInjects['root'] . &quot;/view/partial/header.php&quot;) ?&gt;

    &lt;script type=&quot;text/javascript&quot;&gt;
        custom js
    &lt;/script&gt;

&lt;/head&gt;
    page content
&lt;/html&gt;
</code></pre><div class=comments><hr><h2>Comments</h2><span style=display:none><ul><li>issue-term=AB muutmine ja vana koodi kohandamine</li><li>issue-term=2021-04-24_#1</li></ul></span><script src=https://utteranc.es/client.js repo=oskar-anderson/InternshipBlog issue-term=2021-04-24_#1 label=utterance-comment theme=github-light crossorigin=anonymous async></script></div></article></div><aside class="col-sm-3 ml-auto blog-sidebar"><h2 style=font-size:125%;text-transform:uppercase>Latest</h2><div><ul class=post-list style=list-style:square;padding-left:17px><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/arendamine/ itemprop=url>Arendamine</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/graafi-joonistamine/ itemprop=url>Graafi joonistamine</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/lehe-arendamine/ itemprop=url>Lehe arendamine</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/AB-muutmine-ja%20vana%20koodi%20kohandamine/ itemprop=url>AB muutmine ja vana koodi kohandamine</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/segadused/ itemprop=url>Segadused</a></li></ul></div><h2 style=font-size:125%;text-transform:uppercase>Tags</h2><div><ul class=post-list style=list-style:square;padding-left:17px><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/m%C3%A4rkmed/>m√§rkmed</a>
<span style=color:grey;font-size:80%>(1)</span></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/praktika/>praktika</a>
<span style=color:grey;font-size:80%>(8)</span></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/riina-tallo/>Riina Tallo</a>
<span style=color:grey;font-size:80%>(9)</span></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/test/>test</a>
<span style=color:grey;font-size:80%>(1)</span></li></ul></div></aside></div></div><hr><footer style=margin-bottom:20px><div class=container><a href=#></a><div class=site-title-wrapper><h1 class=site-title><a href=https://oskar-anderson.github.io/InternshipBlog/>Home</a></h1></div></div></footer></body></html>