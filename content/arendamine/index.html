<!doctype html><html lang=en><head><link rel=canonical href=https://oskar-anderson.github.io/InternshipBlog/content/arendamine/><title>Arendamine - My Internship Blog</title><link type=text/css href=https://oskar-anderson.github.io/InternshipBlog/css/bootstrap.min.css rel=stylesheet crossorigin=anonymous><link type=text/css href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css rel=stylesheet><link type=text/css href=https://oskar-anderson.github.io/InternshipBlog/css/main-layout.css rel=stylesheet crossorigin=anonymous><link rel=icon type=image/png href=https://oskar-anderson.github.io/InternshipBlog/favicon.png crossorigin=anonymous></head><body><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://oskar-anderson.github.io/InternshipBlog/>Home</a></h1></div></div></header><header class=post-header><h1 class=post-title itemprop="name headline">Arendamine</h1></header><div class=container><div class=row><div class="col-sm-9 blog-main"><article class=blog-post><header><h2 class=blog-post-title dir=auto><a href=https://oskar-anderson.github.io/InternshipBlog/content/arendamine/>Arendamine</a></h2><p class=blog-post-meta><time datetime=2021-05-30>2021-05-30</time>
Karl Oskar Anderson
<span class="fas fa-tag" aria-hidden=true></span>&nbsp;<a href=/InternshipBlog/tags/praktika/ rel=tag>praktika</a> <a href=/InternshipBlog/tags/riina-tallo/ rel=tag>Riina Tallo</a></p></header><h2 id=13-nädal>13. nädal</h2><h3 id=2405>24.05</h3><p>Kuupäeva päringu vorm on liiga segane, sest kõik väljad sealhulgas &lsquo;relativeDateFrom&rsquo;, &lsquo;absoluteDateFrom&rsquo;, &lsquo;dateFromType&rsquo; saadetakse serverisse töötlemiseks. Tegin vormi JS ümber. &lsquo;Load&rsquo; nupule vajutades parsib JS sobilikud andmed nähtamatusse vormi ja saadab selle. Meetodiks on nüüd &lsquo;get&rsquo;.</p><h3 id=2505>25.05</h3><p>Tegin leheküljele sensori alarmid sektsiooni, et seal piiridest väljaspool olevad temperatuuri ning niiskuse mõõtmise andmeid kuvada. Paraku nii lihtsalt ei saa. Alarme on liiga palju, sest iga mõõtmise tulemus on eraldi alarmina välja toodud. Kombineerisin sama alarmi all kuuluvad mõõtmised kokku.</p><h3 id=2605>26.05</h3><p>Panin viimaste mõõtmiste andmed leheküljele, aga lehekülg laadimine aeglustus tõsiselt. AB ei suuda kuupäevi piisavalt kiiresti võrrelda, et viimane kuupäev kiiresti leida.</p><p>Esimese valikuna proovisin kasutada staatilist singleton meetodi, aga peagi mõistsin, et selline lähenemine töötab .NET, aga mitte PHP, sest PHP server ei hoia staatilisi andmeid mälus.</p><p>Teise valikuna proovisin kasutada SQL subquery:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>/* Old query */</span>
<span style=color:#66d9ef>Select</span> Id, SensorId, Temp, RelHum, DateRecorded 
<span style=color:#66d9ef>FROM</span> SensorReading 
<span style=color:#66d9ef>WHERE</span> SensorId <span style=color:#f92672>=</span> <span style=color:#f92672>?</span> 
<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> DateRecorded <span style=color:#66d9ef>DESC</span> <span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>1</span>;
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>/* New query */</span>
<span style=color:#66d9ef>Select</span> Id, SensorId, Temp, RelHum, DateRecorded 
<span style=color:#66d9ef>FROM</span> SensorReading 
<span style=color:#66d9ef>WHERE</span> DateRecorded <span style=color:#f92672>=</span> 
(
    <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>MAX</span>(DateRecorded)
    <span style=color:#66d9ef>FROM</span> SensorReading <span style=color:#66d9ef>as</span> latest
    <span style=color:#66d9ef>WHERE</span> SensorReading.SensorId <span style=color:#f92672>=</span> SensorId
);
</code></pre></div><p>Tulemus oli veel aeglasem kui algne SQL päring.</p><p>Kolmanda lahendusena proovisin salvestada viimaste mõõtmiste andmed sessiooni:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>array</span><span style=color:#f92672>|</span><span style=color:#66d9ef>null</span> $lastReadings <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SetLastReadingsSingleton</span>(<span style=color:#a6e22e>SensorReading</span> $sensorReading)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> 
{
    <span style=color:#a6e22e>session_start</span>();
    $lastReadings <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>GetSessionLastReadings</span>();
    $lastReadings[$sensorReading<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sensorId</span>] <span style=color:#f92672>=</span> $sensorReading;
    $_SESSION[<span style=color:#e6db74>&#39;lastReadings&#39;</span>] <span style=color:#f92672>=</span> $lastReadings;
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>GetLastReadingsSingleton</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> 
{
    <span style=color:#a6e22e>session_start</span>();
    $lastReadings <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>GetSessionLastReadings</span>();
    $_SESSION[<span style=color:#e6db74>&#39;lastReadings&#39;</span>] <span style=color:#f92672>=</span> $lastReadings;
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$lastReadings;
}

<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>GetSessionLastReadings</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>array</span> {
    <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$lastReadings <span style=color:#f92672>=</span> $_SESSION[<span style=color:#e6db74>&#39;lastReadings&#39;</span>] <span style=color:#f92672>??</span> <span style=color:#66d9ef>null</span>;
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$lastReadings <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) {
        <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$lastReadings <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DalSensorReading</span>())<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>GetLastReadings</span>();
        $_SESSION[<span style=color:#e6db74>&#39;lastReadings&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$lastReadings;
    }
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$lastReadings;
}
</code></pre></div><p>Aga soovitud tulemust ei teki. Iga lehekülje laadimisega luuakse uus session. Paraku ei leidnud ma rohkem infot session&rsquo;i kasutamisest.</p><h3 id=2705>27.05</h3><p>Tegin eraldi Cache.json faili kuhu sensori viimase sissekande andmeid salvestatakse:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SetLastReadingsCache</span>(<span style=color:#a6e22e>SensorReading</span> $sensorReading)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
{
     $cache <span style=color:#f92672>=</span> <span style=color:#a6e22e>CacheJsonDTO</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Read</span>();
     $cache<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sensorReadings</span>[$sensorReadings<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sensorId</span>] <span style=color:#f92672>=</span> $sensorReading;
     (<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CacheJsonDTO</span>($cache<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sensorReadings</span>))<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>Save</span>();
}

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>GetLastReadingsCacheIfNotExistUpdate</span>(<span style=color:#66d9ef>array</span> $sensors)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
{
     $cache <span style=color:#f92672>=</span> <span style=color:#a6e22e>CacheJsonDTO</span><span style=color:#f92672>::</span><span style=color:#a6e22e>Read</span>();
     $isDirty <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
     $lastReadings <span style=color:#f92672>=</span> [];
     <span style=color:#66d9ef>foreach</span> ($sensors <span style=color:#66d9ef>as</span> $sensor) {
         <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>array_key_exists</span>($sensor<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>, $cache<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sensorReadings</span>)) {
             $lastReadings[$sensor<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> $cache<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sensorReadings</span>[$sensor<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>];
             <span style=color:#66d9ef>continue</span>;
         }
         $lastReading <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DalSensorReading</span>())<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>GetLastReading</span>($sensor);
         $isDirty <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
         $lastReadings[$sensor<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> $lastReading;
     }
     <span style=color:#66d9ef>if</span> ($isDirty) {
         (<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CacheJsonDTO</span>($lastReadings))<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>Save</span>();
     }
     <span style=color:#66d9ef>return</span> $lastReadings;
}
</code></pre></div><p>Lõpuks jõudsin töötava lahenduseni. 👍</p><p>Seekord ei esinenud probleeme faili lugemisega, nagu alguses sensori mõõtmiste tulemuste lugemisega, kus data.txt failist loeti ainult paaritud read.</p><p>Ennem kulus andmete kättesaamiseks umbes 2.3s, nüüd saab viimaste mõõtmiste tulemused failist 0.049s jooksul kätte.</p><h3 id=2805>28.05</h3><p>Lisasin sensorite CRUD funktionaalsuse. Create ja Edit vormid on partial view alla. CRUD operatiosioonide joaks peab omama salasõna.</p><p>PHP 8 tüübi määramise võimalused ekisteerivad, aga piiratud määral. Funktsiooni parameetrite ja tagastus väärtuse tüüpide määramiseks lisasin PHPDoci, mis lubab array tüüpe määrata.</p><h2 id=14-nädal>14. nädal</h2><h3 id=3105>31.05</h3><p>Lisasin CRUD operatsioonidele veateated.</p><p>Alustasin portatiivsete sensorite andmete üleslaadimise võimaluse loomist.</p><h3 id=0106>01.06</h3><p>Üleslaetavad portatiivse sensori andmed töötleb JS:</p><ol><li>Loeb CSV failist andmed ridadena välja. Rea eraldajana kasutatakse platvormi spetsiifilist eraldajat:</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JS data-lang=JS><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>GetEol</span>() {
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>aPlatform</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>navigator</span>.<span style=color:#a6e22e>platform</span>.<span style=color:#a6e22e>toLowerCase</span>();
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>aPlatform</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#39;win&#39;</span>) <span style=color:#f92672>!==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;\r\n&#39;</span>
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>aPlatform</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#39;mac&#39;</span>) <span style=color:#f92672>!==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;\r&#39;</span>
    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;\n&#39;</span>
}
</code></pre></div><ol start=2><li>Loob sisseloetud read JS objektideks ümber</li><li>Primitiivne valideerimine</li><li>Kuvab andmed modal elemendis JSON kujul. Modal sisaldab kahte nuppu &lsquo;back&rsquo; ja &lsquo;submit&rsquo;. Model eesmärk on olla ekstra kasutajapoolne valideermise aste. Lisaks saab siia tulevikus lisa funtsionaalsust lisada.</li></ol><p>Sensorite eksporditud andmete formaat olid algselt koma eraldatud CSV fail. Aga imporditud andmed tulevad Comet Vision tarkvarast semikoolon eraldatud CSV failina. Lihtsuse mõttes peaksid CSV failiformaadid samad olema.</p><p>Muutes eksporditud andmete eraldaja semikooloniks ei kuva Excel neid andmeid enam õigesti. Arvasin, et teen midagi valesti, aga Excel loeb koma eraldaja arvuti regiooni seadistustest (list separator). Loll olukord, aga see on Exceli enda viga.</p><h3 id=0206>02.06</h3><p>Lõin üleslaetava andmete PHP serveri poolse osa. Post päringul loetakse JSON andmed, valideeritakse neid ja sisestatakse nad AB või kuvatakse veateadet.</p><p>Palusin töölepingu 2 nädalast pikendamist, et tehtud projekt test serverisse ülesse panna ja serveri üles panemise kogemuse saamiseks.</p><p>Vaatasin kirjutatud koodi üle. Eemaldasin üleliigseid andmeid. Kirjutasin enda tehtud töö README faili üles.</p><h3 id=0306>03.06</h3><p>Käisin kontoris tööd ette näitamas.</p><p>Esines probleem andmebaasi päringute võimsusega. Mõtlesin, et probleem seisneb SensorId välisvõtme indeksis. Aivar ega Kristjan vastata ei osanud. Käisin kõik päringu variatsioonid läbi ja mõõtsin nende aega:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>
<span style=color:#75715e>// this takes 4.25s
</span><span style=color:#75715e></span>$pdo <span style=color:#f92672>=</span> <span style=color:#a6e22e>DbHelper</span><span style=color:#f92672>::</span><span style=color:#a6e22e>GetPdo</span>();
$qry <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SELECT Id, SensorId, Temp, RelHum, DateRecorded, DateAdded 
</span><span style=color:#e6db74>        FROM SensorReading 
</span><span style=color:#e6db74>        WHERE DateRecorded &gt;= ? AND DateRecorded &lt;= ? ORDER BY DateRecorded ASC&#39;</span>
$stmt <span style=color:#f92672>=</span> $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($qry)
$stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([$from, $to])

<span style=color:#75715e>// this takes 0.81s
</span><span style=color:#75715e></span>$qry <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SELECT Id, Temp, RelHum, DateRecorded, DateAdded 
</span><span style=color:#e6db74>        FROM SensorReading 
</span><span style=color:#e6db74>        WHERE DateRecorded &gt;= ? AND DateRecorded &lt;= ? ORDER BY DateRecorded ASC&#39;</span>
$stmt <span style=color:#f92672>=</span> $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>($qry)
$stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([$from, $to])


<span style=color:#e6db74>``</span><span style=color:#960050;background-color:#1e0010>`</span><span style=color:#a6e22e>txt</span>
<span style=color:#f92672>|----|----------|---------------|--------------|------------------|</span>
<span style=color:#f92672>|</span> <span style=color:#a6e22e>Id</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>SensorId</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Temp</span> <span style=color:#f92672>&amp;</span> <span style=color:#a6e22e>RelHum</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>DateRecorded</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>DateAdded</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Time</span> <span style=color:#f92672>|</span> 
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.62</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.74</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.61</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.79</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.63</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>4.23</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.80</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>4.28</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.65</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.74</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.61</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.87</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.72</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>4.20</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>N</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0.77</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>        <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>             <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span>              <span style=color:#f92672>|</span>         <span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>4.16</span> <span style=color:#f92672>|</span>
</code></pre></div><p>DateRecorded väli peab filtreerimise eesmärgil kaasas olema. Tundub, et Id, Temp ja RelHum väljad päringu kiirust eriti ei mõjuta. Tuleb välja, et pärides SensorId ja DateAdded väljad korraga võtab rohkem aega (4.16s), kui pärida neid eraldi kahe SQL lausena (0.87 + 0.77 = 1.64s). Kuidas see võimalik on?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>|----------|-----------|------|
| SensorId | DateAdded | Time |
|        N |         N | 0.82 |
|        N |         Y | 0.87 |
|        Y |         N | 0.77 |
|        Y |         Y | 4.16 |

</code></pre></div><h3 id=0406>04.06</h3><p>Tegin eraldi duplikeeritud SensorReadingTmp tabeli erinevate indeksite ja väljade väärtusetega testimiseks. Proovisin indeksitega probleemi lahendada, aga märgatavat erinevust ei näinud.</p><p>Proovisin panna erinevaid väärtusi DateAdded tulpa (DateRecorded, null, &lsquo;&rsquo;, 22 random chars) ja uurisin päringute erinevate tulpade kominatsioone, aga tulemusetult. Oleks võinud arvata, et tühjad tulbad tõstaksid päringute kiirust. Tegelikult ei ole meil seda välja vaja - statsionaarsete sensorite puhul on selle väärtus null ja portatiivse sensori puhul andmete üleslaadimise tähtaeg, aga leheküljel seda välja ei näidata.</p><p>Tuleb välja, et lühikest aega pärast AB loomist toimuvad SQL päringut aeglaselt, eriti aeglane võib olla esimene päring võttes isegi kuni 1 min.</p><p>Pragune AB on püsti localhosti peal, huvitav kui kiirelt päringud päris serveri vastu toimiksid.</p><div class=comments><hr><h2>Comments</h2><span style=display:none><ul><li>issue-term=Arendamine</li><li>issue-term=2021-05-30_#1</li></ul></span><script src=https://utteranc.es/client.js repo=oskar-anderson/InternshipBlog issue-term=2021-05-30_#1 label=utterance-comment theme=github-light crossorigin=anonymous async></script></div></article></div><aside class="col-sm-3 ml-auto blog-sidebar"><h2 style=font-size:125%;text-transform:uppercase>Latest</h2><div><ul class=post-list style=list-style:square;padding-left:17px><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/l%C3%B5pptulemus/ itemprop=url>Lõpptulemus</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/l%C3%B5pusirge/ itemprop=url>Lõpusirge</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/arendamine/ itemprop=url>Arendamine</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/graafi-joonistamine/ itemprop=url>Graafi joonistamine</a></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/content/lehe-arendamine/ itemprop=url>Lehe arendamine</a></li></ul></div><h2 style=font-size:125%;text-transform:uppercase>Tags</h2><div><ul class=post-list style=list-style:square;padding-left:17px><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/m%C3%A4rkmed/>märkmed</a>
<span style=color:grey;font-size:80%>(1)</span></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/praktika/>praktika</a>
<span style=color:grey;font-size:80%>(10)</span></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/riina-tallo/>Riina Tallo</a>
<span style=color:grey;font-size:80%>(11)</span></li><li><a href=https://oskar-anderson.github.io/InternshipBlog/tags/test/>test</a>
<span style=color:grey;font-size:80%>(1)</span></li></ul></div></aside></div></div><hr><footer style=margin-bottom:20px><div class=container><a href=#></a><div class=site-title-wrapper><h1 class=site-title><a href=https://oskar-anderson.github.io/InternshipBlog/>Home</a></h1></div></div></footer></body></html>